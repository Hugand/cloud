on: '3'

services:
        quarkus:
                build:
                        context: .
                        dockerfile: Dockerfile
                image: quarkus/cloud
                container_name: quarkus/cloud
                restart: unless-stopped
                networks:
                        - app-network

        webserver:
                image: nginx:mailine-alpine
                container_name: cloud_backend
                restart: unless-stopped
                ports:
                        - "80:80"
                volumes:
                        - web-root:/var/www/html
                        - ./nginx-conf:/etc/nginx/conf.d
                        - certbot-etc:/etc/letsencrypt
                        - certbot-var:/var/lib/letsencrypt
                depends_on:
                        - quarkus/cloud
                networks:
                        - app-networks

        certbot:
                image: certbot/certbot
                container_name: certbot
                volumes:
                        - certbot-etc:/etc/letsencrypt
                        - certbot-var:/var/lib/letsencrypt
                        - web-root:/var/www/html
                depends_on:
                        - webserver
                command: cert:wq

